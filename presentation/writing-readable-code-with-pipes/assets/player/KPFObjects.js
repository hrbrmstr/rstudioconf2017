var kpfLayerCounter=0;var eventOverallDuration=0;var KPFPlaybackController=Class.create({initialize:function(b,a){this.domNode=a;this.kpfEvent=null},destroy:function(){this.removeEvent();this.domNode=null},removeEvent:function(){if(this.kpfEvent){this.kpfEvent.destroy();delete this.kpfEvent;this.kpfEvent=null;while(this.domNode.childNodes.length>0){this.domNode.removeChild(this.domNode.childNodes[0])}}},renderEvent:function(a){this.removeEvent();this.kpfEvent=a;this.kpfEvent.renderEvent(this.domNode)},renderEffects:function(){var a=this.kpfEvent.renderEffects(this.kpfEvent.event.effects);return a},animateEffects:function(a){this.kpfEvent.animateEffects(a)},eventOverallEndTime:function(){return this.kpfEvent.eventOverallEndTime}});var KPFEvent=Class.create({initialize:function(a){this.slideId=a.slideId;this.slideIndex=a.slideIndex;this.sceneIndex=a.sceneIndex;this.animationSupported=a.animationSupported;this.event=a.event;this.baseLayer={};this.effects=[];this.cssRenderer={};this.eventOverallEndTime=0;this.overallEndTimeInternal()},destroy:function(){this.baseLayer.destroy();this.cssRenderer.destroy();for(var a=0,b=this.effects.length;a<b;a++){this.effects[a].destroy()}delete this.baseLayer;delete this.cssRenderer;delete this.effects;delete this.event;this.slideId=null;this.slideIndex=null;this.sceneIndex=null;this.animationSupported=null;this.eventOverallEndTime=null},addAnimationsToIdenticalLayer:function(c,f){if(c.animations&&c.animations.length>0){for(var b=0,e=c.animations.length;b<e;b++){f.animations.push(c.animations[b])}}if(c.layers&&c.layers.length>0){for(var a=0,d=c.layers.length;a<d;a++){this.addAnimationsToIdenticalLayer(c.layers[a],f.layers[a])}}},processEffects:function(a){var d=[];for(var h=0;h<a.length;h++){var m=a[h];if(m.type==="actionBuild"){var f=false;var l;for(var g=0,b=d.length;g<b;g++){if(d[g].type==="actionBuild"&&d[g].objectID===m.objectID){l=g;f=true;break}}if(f){this.addAnimationsToIdenticalLayer(m.baseLayer,d[l].baseLayer);if(m.beginTime<d[l].beginTime){d[l].beginTime=m.beginTime}if(m.beginTime+m.duration>d[l].beginTime+d[l].duration){d[l].duration=m.beginTime+m.duration}for(var e=0,c=m.effects.length;e<c;e++){d[l].effects.push(m.effects[e])}if(d[l].names==null){d[l].names=[]}d[l].names.push(m.name)}else{d.push(m)}}else{d.push(m)}}for(var h=0,b=d.length;h<b;h++){d[h].effects=this.processEffects(d[h].effects)}return d},renderEffects:function(b){var k=[];for(var e=0,c=b.length;e<c;e++){var h=new KPFEffect(b[e],this.animationSupported);var f=false;this.cssRenderer.initRendererFlags(h);if(h.baseLayer==null){this.renderAudioOnlyEffect(h)}else{if(h.type==="actionBuild"&&!h.isEmphasisBuild){for(var d=0,m=this.effects.length;d<m;d++){if(this.effects[d].objectID===h.objectID){if(this.effects[d].type==="actionBuild"){f=true}else{f=false}}}}if(this.baseLayer.objectID===h.objectID){var g=new KPFLayer(h.baseLayer,{animationSupported:this.animationSupported,name:h.name,type:h.type,objectID:h.objectID});var l=document.getElementById("layer"+this.baseLayer.layerId);var a=l.parentNode;var n=document.createElement("div");n.setAttribute("id","layer"+g.layerId);this.baseLayer=g;h.kpfLayer=g;this.cssRenderer.layer=g;this.cssRenderer.domNode=n;this.cssRenderer.draw(a);a.removeChild(l)}else{this.renderEffect(this.baseLayer,h,f)}}this.effects.push(h);k.push(h)}return k},renderEffect:function(b,g,f){var d;for(var e=0,c=b.layers.length;e<c;e++){if(b.layers[e].objectID===g.objectID){var h=new KPFLayer(g.baseLayer,{animationSupported:this.animationSupported,name:g.name,type:g.type,objectID:g.objectID},b.bounds.offset);var j="layer"+b.layers[e].layerId;var k=document.getElementById("layer"+b.layers[e].layerId);var a=k.parentNode;g.kpfLayer=h;if(!f){b.layers[e]=h;var l=this.cssRenderer.createNodes(a,b,h);a.replaceChild(l,k)}else{g.currentKPFLayer=b.layers[e]}d=true}else{d=this.renderEffect(b.layers[e],g,f)}if(d){break}}return d},renderEvent:function(a){var b={animationSupported:this.animationSupported};if(this.event.effects&&this.event.effects.length===1){b.name=this.event.effects[0].name;b.type=this.event.effects[0].type;b.objectID=this.event.effects[0].objectID}this.baseLayer=new KPFLayer(this.event.baseLayer,b);this.cssRenderer=new KPFCssRenderer(this.baseLayer,this.sceneIndex,this.animationSupported,this.effects);this.cssRenderer.draw(a)},renderAudioOnlyEffect:function(e){if(e.name!="renderMovie"){return}var b=e.movie;if(!b.isAudioOnly){return}if(gShowController.audioCache==null){gShowController.audioCache={}}var a=b.asset+"-audio";var d=gShowController.audioCache[a];if(d==null){var c=gShowController.textureManager.urlForAsset(b.asset,this.slideId);d=new Audio(c);if(b){if(b.loopMode&&b.loopMode==="looping"){d.loop=true}if(b.volume){d.volume=b.volume}}gShowController.audioCache[a]=d}d.play()},animateEffects:function(c){for(var a=0,b=c.length;a<b;a++){this.animateEffect(c[a])}},animateEffect:function(a){this.cssRenderer.animate(a);if(a.effects.length>0){setTimeout(this.handleEffectDidComplete.bind(this,a),(a.beginTime+a.duration)*1000)}},handleEffectDidComplete:function(b){var d=this.renderEffects(b.effects);for(var a=0,c=d.length;a<c;a++){this.animateEffect(d[a])}},overallEndTime:function(){return this.eventOverallEndTime},overallEndTimeInternal:function(){for(var a=0,d=this.event.effects.length;a<d;a++){var c=0;var b=this.event.effects[a];this.calculateOverallEndTime(c,b)}},calculateOverallEndTime:function(e,c){var b=e+c.beginTime+c.duration;if(b>this.eventOverallEndTime){this.eventOverallEndTime=b}for(var a=0,d=c.effects.length;a<d;a++){this.calculateOverallEndTime(b,c.effects[a])}}});var KPFEffect=Class.create({initialize:function(b,a){this.type=b.type;this.name=b.name;this.beginTime=b.beginTime;this.duration=b.duration;this.objectID=b.objectID;this.baseLayer=b.baseLayer;if(kEmphasisEffects.indexOf(this.name)>-1){this.isEmphasisBuild=true}if(b.movie){this.movie=b.movie}this.effects=[];this.addSubEffect(b.effects,a)},destroy:function(){for(var a=0,b=this.effects.length;a<b;a++){this.destroyEffect(this.effects[a])}this.type=null;this.name=null;this.beginTime=null;this.duration=null;this.objectID=null;delete this.kpfLayer;delete this.effects;delete this.baseLayer;if(this.movie){delete this.movie}if(this.currentKPFLayer){delete this.currentKPFLayer}},destroyEffect:function(b){for(var a=0,c=b.effects.length;a<c;a++){this.destroyEffect(b.effects[a])}b.type=null;b.name=null;b.beginTime=null;b.duration=null;b.objectID=null;delete b.kpfLayer;delete b.effects;delete b.baseLayer;if(b.movie){delete b.movie}if(b.currentKPFLayer){delete b.currentKPFLayer}},addSubEffect:function(c,a){for(var b=0,e=c.length;b<e;b++){var d=new KPFEffect(c[b],a);this.effects.push(d)}}});var KPFMovie=Class.create({initialize:function(b){this.objectID=b.objectID;this.movieId=b.movieId;this.width=b.width;this.height=b.height;this.sceneIndex=b.sceneIndex;this.textureId=b.textureId;this.src=b.src;this.showControls=b.showControls;this.previousSiblingTextureId=b.previousSiblingTextureId;this.movieDiv=b.movieDiv;var a=this.videoElement=document.createElement("video");this.setDefaultStyle();setElementProperty(a,"pointer-events","all");a.setAttribute("id",this.movieId);a.setAttribute("src",this.src);if(this.showControls){a.setAttribute("controls","controls")}this.isFirstRendered=true;this.isEnded=false;this.isPlaying=false},destroy:function(){var a=this.videoElement;if(a){a.pause();a.src=""}},setDefaultStyle:function(){var a=this.videoElement.style;a.top="0px";a.left="0px";a.width=this.width+"px";a.height=this.height+"px";a.position=kPositionAbsolutePropertyValue;a.visibility="hidden"},observeEvents:function(a){var b=this.videoElement;Event.stopObserving(b,"canplay");Event.stopObserving(b,"ended");Event.observe(b,"canplay",this.handleMovieDidStart.bind(this,a));Event.observe(b,"ended",this.handleMovieDidEnd.bind(this,a))},setLoop:function(a){this.videoElement.loop=a},setVolume:function(a){this.videoElement.volume=a},removeControls:function(){if(this.videoElement.hasAttribute("controls")){this.videoElement.removeAttribute("controls")}},handleMovieDidStart:function(a){this.videoElement.style.visibility="visible";if(a){setTimeout(this.hideMoviePoster.bind(this,a),120)}},handleMovieDidEnd:function(a){if(!this.videoElement.loop){this.isEnded=true}},startMovie:function(){if(this.videoElement){this.videoElement.play();this.isPlaying=true}},stopMovie:function(){if(this.videoElement){this.videoElement.pause()}},hideMoviePoster:function(a){var b=a.style;b.visibility="hidden";b.display="none";if(a.parentNode){a.parentNode.removeChild(a)}}});var KPFCssRenderer=Class.create({initialize:function(b,d,a,c){this.textureId=b.textureId;this.nativeWidth=b.bounds.width;this.nativeHeight=b.bounds.height;this.opacity=b.opacity;this.visibility=b.hidden===true?"hidden":"visible";this.textureTransform=b.textureTransform;this.affineTransform=b.affineTransform;this.anchorPoint=b.anchorPoint;this.contentsRect=b.contentsRect;this.layer=b;this.sceneIndex=d;this.animationSupported=a;this.enableCompositingUsingBackface=false;this.enablePreserve3DFromParent=false;if(c.length>0){this.initRendererFlags(c[0])}this.domNode=document.createElement("div");this.domNode.setAttribute("id","layer"+b.layerId)},initRendererFlags:function(a){if(a.type==="transition"&&a.name!="apple:ca-swing"&&a.name!="com.apple.iWork.Keynote.BLTSwoosh"){this.enableCompositingUsingBackface=true;this.enablePreserve3DFromParent=true;if(isChrome&&(a.name==="apple:ca-push"||a.name==="com.apple.iWork.Keynote.BLTFadeThruColor")){this.enableCompositingUsingBackface=false;this.enablePreserve3DFromParent=false}}else{this.enableCompositingUsingBackface=false;this.enablePreserve3DFromParent=false}if(a.name==="apple:apple-grid"){this.isGridTransition=true}else{if(a.name==="com.apple.iWork.Keynote.BLTMosaicFlip"){this.isMosaicTransition=true}else{if(a.name==="com.apple.iWork.Keynote.BLTSwoosh"&&a.type==="transition"){this.isSwooshTransition=true}}}},destroy:function(){this.textureId=null;this.nativeWidth=null;this.nativeHeight=null;this.opacity=null;this.visibility=null;this.textureTransform=null;this.affineTransform=null;this.anchorPoint=null;this.textureAnimation=null;this.contentsRect=null;this.requiresPerspectiveTransform=null;this.sceneIndex=null;if(this.domNode.hasChildNodes()){while(this.domNode.childNodes.length>0){this.domNode.removeChild(this.domNode.firstChild)}}this.domNode=null},addAnimationNode:function(d,c,a,b){if(c==null){return d}var e=c.shift();if(e==null){return d}var g=document.createElement("div");var f=a+"-"+escapeTextureId(e);g.setAttribute("id",f);if(b.initialState.masksToBounds){setElementProperty(g,"overflow","hidden")}if(this.enableCompositingUsingBackface){setElementProperty(g,kBackfaceVisibilityPropertyName,"hidden")}else{if(this.isSwooshTransition){setElementProperty(g,kTransformPropertyName,"translateZ(0px)")}}this.setStyle(g,"0px","0px",d.style.width,d.style.height,kPositionAbsolutePropertyValue,null,null);setElementProperty(g,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue);if(b.anchorPoint.pointX!=0.5||b.anchorPoint.pointY!=0.5){setElementProperty(g,kTransformOriginPropertyName,(b.anchorPoint.pointX*100)+"% "+(b.anchorPoint.pointY*100)+"%")}if(b.transformOriginZValue!=""&&e!="opacity"&&e!="doubleSided"){if(e!="anchorPointZ"){if(Prototype.Browser.Gecko){setElementProperty(g,kTransformOriginPropertyName,(b.anchorPoint.pointX*100)+"% "+(b.anchorPoint.pointY*100)+"% "+b.transformOriginZValue+"px")}else{setElementProperty(g,kTransformOriginZPropertyName,b.transformOriginZValue+"px");if(navigator.userAgent.lastIndexOf("Chrome/")<=0){setElementProperty(g,kTransformPropertyName,"translateZ("+b.transformOriginZValue+"px)")}}}}d.appendChild(g);return this.addAnimationNode(g,c,a,b)},createNodes:function(a,c,b){var d=this.addNode(a,c,b);return d},addNode:function(q,A,d){var B="layer"+d.layerId;var W=document.createElement("div");W.setAttribute("id",B);setElementProperty(W,"pointer-events","none");var J=d.contentsRect.x;var H=d.contentsRect.y;var K=d.contentsRect.width;var V=d.contentsRect.height;var af=d.affineTransform[0];var ad=d.affineTransform[1];var ac=d.affineTransform[2];var ab=d.affineTransform[3];var aa=d.affineTransform[4];var X=d.affineTransform[5];var z="matrix("+af+","+ad+","+ac+","+ab+","+(aa+d.bounds.offset.pointX)+","+(X+d.bounds.offset.pointY)+")";var o=d.bounds;var r=o.width;var L=o.height;this.setStyle(W,"0px","0px",r+"px",L+"px",kPositionAbsolutePropertyValue,d.opacity,d.visibility);setElementProperty(W,kTransformPropertyName,z);if(d.anchorPoint.pointX!=0.5||d.anchorPoint.pointY!=0.5){setElementProperty(W,kTransformOriginPropertyName,(d.anchorPoint.pointX*100)+"% "+(d.anchorPoint.pointY*100)+"%")}if(d.initialState.masksToBounds){setElementProperty(W,"overflow","hidden")}q.appendChild(W);var C;if(this.animationSupported){C=this.addAnimationNode(W,d.divNames,B,d)}else{C=W}if(d.isTransition&&this.enablePreserve3DFromParent){if(A.sublayerTransform[11]!=0){setElementProperty(W,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)}if(d.sublayerTransform[11]!=0){setElementProperty(W,kPerspectivePropertyName,gShowController.stageManager.perspective+"px");setElementProperty(W,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)}}else{if(A.sublayerTransform[11]!=0){setElementProperty(q,kPerspectivePropertyName,gShowController.stageManager.perspective+"px");setElementProperty(W,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)}else{setElementProperty(W,kTransformStylePropertyName,kTransformStyleFlatPropertyValue)}}if(isChrome){if(this.enableCompositingUsingBackface){setElementProperty(W,kBackfaceVisibilityPropertyName,"hidden")}else{if(this.isSwooshTransition){setElementProperty(W,kTransformPropertyName,"translateZ(0px)")}}}var G=d.textureId;if(G){var t=gShowController.textureManager;var F;var e;if(d.hasContentsAnimation){var ae=d.cssAnimation.animations;for(var m=0,S=ae.length;m<S;m++){if(ae[m].property==="contents"){G=ae[m].to.texture;e=ae[m].from.texture;break}}}var F=this.cloneNode(t.getTextureObject(this.sceneIndex,G),B);F.setAttribute("id",G);if(browserPrefix==="webkit"&&d.isTransition==null){setElementProperty(F,kTransformPropertyName,"translateZ(0px)")}if(J===0&&H===0&&K===1&&V===1){this.setStyle(F,"0px","0px",r+"px",L+"px",kPositionAbsolutePropertyValue,null,null)}else{var j=gShowController.script;var a=j.originalSlideWidth;var c=j.originalSlideHeight;var n=H*c;var O=(J+K)*a;var b=(H+V)*c;var k=J*a;this.setStyle(F,(-n)+"px",(-k)+"px",a+"px",c+"px",kPositionAbsolutePropertyValue,null,null);setElementProperty(F,"clip","rect("+n+"px, "+O+"px, "+b+"px, "+k+"px)")}if(d.isTransition){if(isChrome){if(this.enableCompositingUsingBackface){if(!this.isGridTransition&&!this.isMosaicTransition){setElementProperty(F,kBackfaceVisibilityPropertyName,"hidden")}}else{if(this.isSwooshTransition){setElementProperty(F,kTransformPropertyName,"translateZ(0px)")}}}else{if(this.enableCompositingUsingBackface){setElementProperty(F,kBackfaceVisibilityPropertyName,"hidden")}else{setElementProperty(F,kTransformPropertyName,"translateZ(0px)")}}}var f=t.getTextureInfo(this.sceneIndex,G);var E=d.animationInfo.objectID;var g=d.animationInfo&&d.animationInfo.type==="buildOut";var N;var s;if(f.movie){var P=t.getMovieUrl(this.sceneIndex,G);var I=/(?:\.([^.]+))?$/;var Z=I.exec(P)[1];if(Z==="gif"){s=new Image();this.setStyle(s,"0px","0px",r+"px",L+"px",kPositionAbsolutePropertyValue,null,null);Event.observe(s,"load",this.hideElement.bind(this,F));s.src=P}else{if(gShowController.movieCache==null){gShowController.movieCache={}}var M=E+"-video";d.hasMovie=true;d.movieId=M;N=gShowController.movieCache[M];if(N==null){var U;for(var T=0,u=A.layers.length;T<u;T++){if(G===A.layers[T].textureId){if(T>0){U=A.layers[T-1].textureId}break}}var Y={objectID:E,movieId:M,width:r,height:L,sceneIndex:this.sceneIndex,textureId:G,src:P,showControls:gShowController.isRecording===false?true:false,previousSiblingTextureId:U,movieDiv:W};N=new KPFMovie(Y);gShowController.movieCache[M]=N;N.observeEvents(F)}}}else{var Q=gShowController.movieCache;if(Q){var M=E+"-video";N=Q[M];if(!N){var D=A.objectID;if(D){M=D+"-video";N=Q[M]}}}}if(d.hasContentsAnimation){F.setAttribute("preserveAspectRatio","none");var v=document.createElement("div");v.id=B+"-contents-to";this.setStyle(v,F.style.top,F.style.left,F.style.width,F.style.height,kPositionAbsolutePropertyValue,null,null);v.appendChild(F);C.appendChild(v);setElementProperty(v,"opacity",0);var p=gShowController.textureManager.getTextureObject(this.sceneIndex,e).cloneNode(true);p.setAttribute("id",e);this.setStyle(p,"0px","0px",r+"px",L+"px",kPositionAbsolutePropertyValue,null,null);setElementProperty(p,kBackfaceVisibilityPropertyName,"hidden");var l=document.createElement("div");l.id=B+"-contents-from";this.setStyle(l,p.style.top,p.style.left,p.style.width,p.style.height,kPositionAbsolutePropertyValue,null,null);l.appendChild(p);C.appendChild(l)}else{C.appendChild(F);if(s){C.appendChild(s)}}if(N){if(N.isFirstRendered){C.insertBefore(N.videoElement,F);N.isFirstRendered=false}else{C.appendChild(N.movieDiv);if(g){N.stopMovie();N.removeControls()}else{F.style.visibility="hidden";F.style.display="none";if(N.isPlaying&&!N.isEnded){N.startMovie()}}}}}else{if(d.initialState.backgroundColor){var R=d.initialState.backgroundColor;setElementProperty(C,"background-color","rgba("+parseInt(R[0]*255)+","+parseInt(R[1]*255)+","+parseInt(R[2]*255)+","+R[3]+")")}}for(var T=0,u=d.layers.length;T<u;T++){this.addNode(C,d,d.layers[T])}return W},cloneNode:function(n,j){var q=n.cloneNode(true);if(q.nodeName.toLowerCase()==="svg"){var g=q.getElementsByTagName("clipPath");if(g.length>0){var a={};for(var r=0,f=g.length;r<f;r++){var b=g[r];var m=b.id;var k=m+"-"+j;b.setAttributeNS(null,"id",k);a[m]=k}var l=q.getElementsByTagName("g");for(var r=0,f=l.length;r<f;r++){var d=l[r];var o=d.getAttributeNS(null,"clip-path");if(!o){continue}var h=/\(#([^)]+)\)/;if(isIE||isEdge){h=/\(\"#([^)]+)\"\)/}var c=h.exec(o);if(!c){continue}var p=a[c[1]];d.setAttributeNS(null,"clip-path","url(#"+p+")")}}}if(isIE&&browserVersion>=10){var s=n.getElementsByTagName("feGaussianBlur");if(s){var e=q.getElementsByTagName("feGaussianBlur");for(var r=0,f=s.length;r<f;r++){e[r].setAttribute("stdDeviation",s[r].getAttribute("stdDeviation"))}}}return q},hideElement:function(a){a.style.visibility="hidden"},serializeSvg:function(e){var f=e.getElementsByTagName("image");for(var d=0,b=f.length;d<b;d++){var a=f[d];var g=document.createElement("a");g.href=a.getAttributeNS("http://www.w3.org/1999/xlink","href");var j=window.location.protocol+"//"+g.host+g.pathname;a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",j)}var h=new XMLSerializer;var c=h.serializeToString(e);return c},draw:function(a){this.setStyle(this.domNode,"0px","0px",this.nativeWidth+"px",this.nativeHeight+"px",kPositionAbsolutePropertyValue,this.opacity,this.visibility);if(browserPrefix==="webkit"){if(this.enableCompositingUsingBackface&&isChrome){setElementProperty(this.domNode,kBackfaceVisibilityPropertyName,"hidden")}else{setElementProperty(this.domNode,kTransformPropertyName,"translateZ(0px)")}}if(this.layer.sublayerTransform[11]!=0){setElementProperty(this.domNode,kPerspectivePropertyName,gShowController.stageManager.perspective+"px");setElementProperty(this.domNode,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue)}else{setElementProperty(this.domNode,kTransformStylePropertyName,kTransformStyleFlatPropertyValue)}for(var b=0,c=this.layer.layers.length;b<c;b++){this.createNodes(this.domNode,this.layer,this.layer.layers[b])}a.appendChild(this.domNode)},setStyle:function(f,h,g,e,b,a,d,c){f.style.top=h;f.style.left=g;f.style.width=e;f.style.height=b;f.style.position=a;if(d!=null&&d!=undefined){f.style.opacity=d}if(c!=null&&c!=undefined){f.style.visibility=c}},overallEndTime:function(a){var b={};b.duration=0;this.overallEndTimeForLayer(this.layer,b);return b.duration},overallEndTimeForLayer:function(b,c){if(b.cssAnimation){if(b.cssAnimation.overallEndTime>c.duration){c.duration=b.cssAnimation.overallEndTime}}for(var a=0,d=b.layers.length;a<d;a++){this.overallEndTimeForLayer(b.layers[a],c)}},animate:function(a){if(this.animationSupported){if(a.kpfLayer){if(a.movie){this.animateEffect(a,a.kpfLayer,a.currentKPFLayer?a.currentKPFLayer:null,a.movie)}else{this.animateEffect(a,a.kpfLayer,a.currentKPFLayer?a.currentKPFLayer:null)}}}},animateEffect:function(o,a,j,e){if(a.cssAnimationRules.length>0){var g=j?"layer"+j.layerId:"layer"+a.layerId;var d=document.getElementById(g);if(d){this.applyCssAnimation(d,a,j)}else{if(o.currentKPFLayer){g="layer"+o.currentKPFLayer.layerId;if(o.currentKPFLayer.layers[0]){g="layer"+o.currentKPFLayer.layers[0].layerId}d=document.getElementById(g);if(d){this.applyCssAnimation(d,a,o.currentKPFLayer)}}}}else{if(a.hasMovie&&a.animationInfo.name==="renderMovie"){var n=gShowController.movieCache[a.movieId];if(n){if(e.loopMode&&e.loopMode==="looping"){n.setLoop(true)}if(e.volume){n.setVolume(e.volume)}n.startMovie()}}if(j){var b=document.getElementById("layer"+j.layerId);var k=window.getComputedStyle(b,null);var l=k.getPropertyValue(kTransformPropertyName);var f=parseTransformMatrix(l);var m="matrix("+f[0]+","+f[1]+","+f[2]+","+f[3]+","+a.bounds.offset.pointX+","+a.bounds.offset.pointY+")";if(o.name==="apple:action-motion-path"){setElementProperty(b,kTransformPropertyName,m)}}}for(var h=0,c=a.layers.length;h<c;h++){this.animateEffect(o,a.layers[h],j?j.layers[h]:null,e)}},applyCssAnimation:function(t,d,F){var N=d.cssAnimation;var w=d.cssAnimationRules;var M=d.cssAnimation.overallEndTime;if(d.hasMovie){if(d.animationInfo.type==="buildOut"){this.stopMovie(document.getElementById(d.movieId))}}if(isChrome&&d.animationInfo.name==="apple:doorway"){if(d.layers.length===0&&d.contentsRect.x===0&&d.contentsRect.y===0&&d.contentsRect.width===1&&d.contentsRect.height===1){t.style.visibility="hidden"}}for(var B in N.keyAnimations){if(B!="bounds"){continue}var p=N.keyAnimations[B];var u=document.styleSheets[1].cssRules;for(var T=0,X=u.length;T<X;T++){var q=u[T];var y=t.id+"-"+B;if(q.name===y){while(q.cssRules.length>0){if(isIE){for(var S=0,z=q.cssRules.length;S<z;S++){q.deleteRule(S)}}else{q.deleteRule(q.cssRules[0].keyText)}}for(var S=0,v=p.keyframes.length;S<v;S++){var e=p.keyframes[S];if(B==="bounds"){var O,U,a,c;if(e.keyframe==0){O=e.value.width;U=e.value.height;q.appendRule("0% {"+kTransformPropertyName+": scaleX(1) scaleY(1); "+kAnimationTimingFunctionPropertyName+": "+e.timingFunction+";}")}else{a=e.value.width;c=e.value.height;q.appendRule(e.keyframe+"% {"+kTransformPropertyName+": scaleX("+a/O+") scaleY("+c/U+"); "+kAnimationTimingFunctionPropertyName+": "+e.timingFunction+";}")}}}}}}if(d.initialState.rotation!==0||d.initialState.scale!==1){var f=document.getElementById(t.id);var C=window.getComputedStyle(f,null);var H=C.getPropertyValue(kTransformPropertyName);var I=parseTransformMatrix(H);var k="matrix(1,0,0,1,"+I[4]+","+I[5]+")";setElementProperty(f,kTransformPropertyName,k);var s=document.getElementById(t.id+"-"+escapeTextureId("transform.rotation.z"));if(s){setElementProperty(s,kTransformPropertyName,"rotateZ("+d.initialState.rotation+"rad)")}var A=document.getElementById(t.id+"-"+escapeTextureId("transform.scale.x"));if(A){setElementProperty(A,kTransformPropertyName,"scaleX("+d.initialState.scale+")")}var l=document.getElementById(t.id+"-"+escapeTextureId("transform.scale.y"));if(l){setElementProperty(l,kTransformPropertyName,"scaleY("+d.initialState.scale+")")}}for(var B in N.keyAnimations){var p=N.keyAnimations[B];var x=p.keyActions;var E=x[x.length-1];var D=p.keyframes[p.keyframes.length-1];var Y=this.cssPropertyNameForAction(B);var R=this.cssPropertyValueForActionValue(B,D.value);var h=M+"s";var y="";var K="";if(B==="isPlaying"){continue}if(F&&d.animationInfo.type==="actionBuild"&&kActionBuildKeyAnimations[d.animationInfo.name].indexOf(B)===-1){continue}if(B==="doubleSided"){var g=document.getElementById(t.id+"-"+escapeTextureId(B));if(g){setElementProperty(g,Y,R)}continue}switch(B){case"opacity":y=t.id+"-opacity";K=y;if(F){if(document.getElementById(y)==null){y=t.id}K="layer"+d.layerId+"-opacity"}else{setElementProperty(t,"opacity",1)}break;case"hidden":Y="opacity";if(R==="hidden"){R=0}else{t.style.visibility="visible";R=1}y=t.id;K=y+"-hidden";if(F){K="layer"+d.layerId+"-hidden"}break;case"bounds":y=t.id+"-bounds";K=y;if(F){K="layer"+d.layerId+"-bounds"}var O,U,r,G;var m=p.keyframes[0];var P=p.keyframes[p.keyframes.length-1];R="scaleX("+P.value.width/m.value.width+") scaleY("+P.value.height/m.value.height+")";break;default:y=t.id+"-"+escapeTextureId(B);K=y;if(F){K="layer"+d.layerId+"-"+escapeTextureId(B)}break}if(B==="contents"){var Q=t.id+"-contents-from";var V=t.id+"-contents-to";var J=Q;var o=V;if(F){J="layer"+d.layerId+"-contents-from";o="layer"+d.layerId+"-contents-to"}var n=document.getElementById(Q);var W=document.getElementById(V);setElementProperty(n,"opacity",0);setElementProperty(n,kAnimationNamePropertyName,J);setElementProperty(n,kAnimationDurationPropertyName,h);setElementProperty(W,"opacity",1);setElementProperty(W,kAnimationNamePropertyName,o);setElementProperty(W,kAnimationDurationPropertyName,h);continue}var b=document.getElementById(y);if(b){if(B==="anchorPoint"){var L={x:D.value.pointX,y:D.value.pointY};if(d.magicMoveOffsetValue){L.x=d.magicMoveOffsetValue.pointX;L.y=d.magicMoveOffsetValue.pointY}Y=kTransformPropertyName;R="translateX("+L.x+"px) translateY("+L.y+"px)"}else{if(B==="anchorPointZ"){if(Prototype.Browser.Gecko||navigator.userAgent.lastIndexOf("Chrome/")>0){Y=kTransformPropertyName;R="translateZ("+-d.transformOriginZValue+"px)"}else{Y=kTransformPropertyName;R="translateZ("+d.transformOriginZValue+"px)"}}}if(B!=="hidden"){setElementProperty(b,Y,R)}setElementProperty(b,kAnimationFillModePropertyName,E.fillMode==="removed"?"none":E.fillMode);setElementProperty(b,kAnimationNamePropertyName,K);setElementProperty(b,kAnimationDurationPropertyName,h)}}},cssPropertyValueForActionValue:function(a,b){switch(a){case"hidden":if(b.scalar===true){return"hidden"}else{return"visible"}case"anchorPoint":return b.pointX+"% "+b.pointY+"%";case"anchorPointZ":return b.scalar;case"position":return"translate("+b.pointX+"px,"+b.pointY+"px)";case"zPosition":return"translateZ("+b.scalar+"px)";case"translationEmphasis":return"translateX("+b.translationEmphasis[0]+"px) translateY("+b.translationEmphasis[1]+"px) translateZ("+b.translationEmphasis[2]+")";case"rotationEmphasis":return"rotateZ("+b.rotationEmphasis[6]+"rad)";case"scaleEmphasis":return"scale3d("+ensureScaleFactorNotZero(b.scaleEmphasis[3])+","+ensureScaleFactorNotZero(b.scaleEmphasis[4])+","+ensureScaleFactorNotZero(b.scaleEmphasis[5])+")";case"transform.scale":case"transform.scale.xy":return"scale("+ensureScaleFactorNotZero(b.scalar)+")";case"transform.scale.x":return"scaleX("+ensureScaleFactorNotZero(b.scalar)+")";case"transform.scale.y":return"scaleY("+ensureScaleFactorNotZero(b.scalar)+")";case"transform.rotation.x":return"rotateX("+b.scalar+"rad)";case"transform.rotation.y":return"rotateY("+b.scalar+"rad)";case"transform.rotation.z":case"transform.rotation":return"rotateZ("+b.scalar+"rad)";case"transform.translation":return"translateX("+b.pointX+"px) translateY("+b.pointY+"px)";case"transform.translation.x":return"translateX("+b.scalar+"px)";case"transform.translation.y":return"translateY("+b.scalar+"px)";case"transform.translation.z":return"translateZ("+b.scalar+"px)";case"isPlaying":case"opacity":case"opacityMultiplier":return b.scalar+"";case"transform":return"matrix3d("+b.transform+")";case"doubleSided":if(b.scalar===false){return"hidden"}else{return"visible"}default:return"some value"}},cssPropertyNameForAction:function(a){switch(a){case"hidden":return kVisibilityPropertyName;case"anchorPoint":return kTransformOriginPropertyName;case"anchorPointZ":return kTransformOriginZPropertyName;case"opacityMultiplier":return kOpacityPropertyName;case"translationEmphasis":case"rotationEmphasis":case"scaleEmphasis":case"position":case"zPosition":case"transform":case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":case"transform.rotation.x":case"transform.rotation.y":case"transform.rotation.z":case"transform.rotation":case"transform.translation":case"transform.translation.x":case"transform.translation.y":case"transform.translation.z":case"bounds":return kTransformPropertyName;case"doubleSided":return kBackfaceVisibilityPropertyName;case"contents":return kBackgroundImagePropertyName;default:return a}},hideMoviePoster:function(a){a.style.visibility="hidden"},handleMovieDidStart:function(a,b){b.style.visibility="visible";setTimeout(this.hideMoviePoster.bind(this,a),120)},handleMovieDidEnd:function(a,b){if(!b.loop){b.isEnded=true}},startMovie:function(a){if(a){a.play();a.isPlaying=true}},stopMovie:function(a){if(a){a.pause()}}});var KPFLayer=Class.create({initialize:function(c,d,b){this.animationInfo=d;this.layerId=kpfLayerCounter;kpfLayerCounter=kpfLayerCounter+1;this.objectID=c.objectID!=null?c.objectID:null;this.textureId=c.texture?c.texture:null;this.animations=c.animations;this.initialState=c.initialState;this.cssAnimationRules=[];this.layers=[];this.affineTransform=this.initialState.affineTransform;this.position=this.initialState.position;this.textureTransform="";if(this.initialState.transform!=null&&this.initialState.transform!=undefined){this.textureTransform="matrix3D("+this.initialState.transform+")"}else{this.textureTransform="matrix("+this.affineTransform+")"}this.anchorPoint=this.initialState.anchorPoint;if(b==null){b={pointX:0,pointY:0}}var a=this.position.pointX-this.initialState.width/2-(this.anchorPoint.pointX-0.5)*this.initialState.width;var e=this.position.pointY-this.initialState.height/2-(this.anchorPoint.pointY-0.5)*this.initialState.height;a=Math.round(a*1000000)/1000000;e=Math.round(e*1000000)/1000000;this.bounds={width:this.initialState.width,height:this.initialState.height,origin:{pointX:this.affineTransform[4],pointY:this.affineTransform[5]},offset:{pointX:a,pointY:e},canvasOffset:{pointX:a+b.pointX,pointY:e+b.pointY}};this.sublayerTransform=this.initialState.sublayerTransform;this.contentsRect=this.initialState.contentsRect;this.hidden=this.initialState.hidden;this.opacity=this.initialState.opacity;this.visibility=this.hidden===true?"hidden":"visible";this.addSublayer(c.layers,d,this.bounds.offset);if(d.animationSupported){this.initLayerAnimations()}},destroy:function(){this.initialState=null;this.cssAnimationRules=null;this.affineTransform=null;this.textureTransform=null;this.anchorPoint=null;this.anchorPointZ=null;this.bounds=null;this.contentsRect=null;this.hidden=null;this.opacity=null},addSublayer:function(f,e,d){for(var a=0,b=f.length;a<b;a++){var c=new KPFLayer(f[a],e,d);this.layers.push(c)}},initLayerAnimations:function(){var k=false;var h=false;var b=false;var q=false;var g=false;var f=false;var d=false;var a=false;var n=false;var m=false;var l=false;var s=false;var v=false;var u=false;var c=false;var w=false;var o=false;var r=[];var e=false;if(this.animationInfo.type==="actionBuild"){this.isActionBuild=true}else{if(this.animationInfo.type==="buildIn"){this.isBuildIn=true}else{if(this.animationInfo.type==="buildOut"){this.isBuildOut=true}else{if(this.animationInfo.type==="transition"){this.isTransition=true;if(this.animationInfo.name==="apple:magic-move-implied-motion-path"){this.isMagicMove=true}else{if(this.animationInfo.name==="apple:ca-isometric"){e=true}}}}}}if(this.animations.length>0){this.cssAnimation=new KPFCssAnimation(this.animations,this)}if(this.cssAnimation){this.divNames=[];var p={isPlaying:0,opacityMultiplier:1,hidden:2};for(var x in this.cssAnimation.keyAnimations){if(!p.hasOwnProperty(x)){if(x=="opacity"){h=true;if(this.isActionBuild){for(var t=0,j=this.layers.length;t<j;t++){if(this.layers[t].animations.length===0){if(!this.layers[t].divNames){this.layers[t].divNames=[]}this.layers[t].divNames.push("opacity");this.layers[t].divNames.push("position");this.layers[t].divNames.push("transform.rotation.z");this.layers[t].divNames.push("transform.scale.x");this.layers[t].divNames.push("transform.scale.y")}}}}else{if(x==="anchorPoint"){b=true}else{if(x==="anchorPointZ"){q=true}else{if(!e&&x==="transform.translation.x"){g=true}else{if(!e&&x==="transform.translation.y"){f=true}else{if(!e&&x==="transform.translation.z"){d=true}else{if(!e&&x==="transform.translation"){a=true}else{if(!e&&x==="transform.rotation.x"){n=true}else{if(!e&&x==="transform.rotation.y"){m=true}else{if(!e&&x==="transform.rotation.z"){l=true}else{if(!e&&x==="transform.rotation"){s=true}else{if(x==="transform.scale.x"){v=true}else{if(x==="transform.scale.y"){u=true}else{if(x==="transform.scale.xy"){c=true}else{if(x==="transform.scale"){w=true}else{if(x==="transform"){o=true}else{if(x==="doubleSided"){k=true}else{if(x==="contents"){this.hasContentsAnimation=true}else{if(x==="bounds"){this.hasBoundsAnimation=true}else{if(x==="position"){this.hasPosition=true}else{r.push(x)}}}}}}}}}}}}}}}}}}}}}}if(h||this.isActionBuild){this.divNames.push("opacity")}if(o){this.divNames.push("transform")}if(this.hasPosition||this.isActionBuild){this.divNames.push("position")}if(b){this.divNames.push("anchorPoint")}if(q){this.divNames.push("anchorPointZ")}for(var t=0,j=r.length;t<j;t++){this.divNames.push(r[t])}if(g){this.divNames.push("transform.translation.x")}if(f){this.divNames.push("transform.translation.y")}if(a){this.divNames.push("transform.translation")}if(d){this.divNames.push("transform.translation.z")}if(n){this.divNames.push("transform.rotation.x")}if(m){this.divNames.push("transform.rotation.y")}if(l){this.divNames.push("transform.rotation.z")}if((this.initialState.rotation!==0||this.isActionBuild)&&this.divNames.indexOf("transform.rotation.z")===-1){this.divNames.push("transform.rotation.z")}if(s){this.divNames.push("transform.rotation")}if(v){this.divNames.push("transform.scale.x")}if(u){this.divNames.push("transform.scale.y")}if(this.initialState.scale!==1||this.isActionBuild){if(this.divNames.indexOf("transform.scale.x")===-1){this.divNames.push("transform.scale.x")}if(this.divNames.indexOf("transform.scale.y")===-1){this.divNames.push("transform.scale.y")}}if(c){this.divNames.push("transform.scale.xy")}if(w){this.divNames.push("transform.scale")}if(this.hasBoundsAnimation){this.divNames.push("bounds")}if(k){this.divNames.push("doubleSided")}}}});var KPFCssAnimation=Class.create({initialize:function(o,I){this.kDelta=0.0001;this.kRoundingFactor=10000;this.animations=[];this.keyAnimations={};for(var C=0,g=o.length;C<g;C++){var F=o[C];var v=F.beginTime;var b=F.duration;var d=F.timingFunction?F.timingFunction:"linear";var H;var G;var l;var f;var y;var w=v+b;this.overallEndTime=0;if(w>this.overallEndTime){this.overallEndTime=w}if(d=="custom"){H=F.timingControlPoint1x;G=F.timingControlPoint1y;l=F.timingControlPoint2x;f=F.timingControlPoint2y}if(F.animations!=null&&F.animations.length>0){var q=F.animations;var p=v;if(q[0].property==null){p=q[0].beginTime;q=q[0].animations}for(var z=0,e=q.length;z<e;z++){var a=q[z];var n=a.property;var B=this.keyAnimations[n];if(B==null){B={groupBeginTime:p,earliestBeginTime:p+a.beginTime,latestEndTime:-1,keyActions:[]};this.keyAnimations[n]=B}if(p+a.beginTime+a.duration>B.latestEndTime){B.latestEndTime=p+a.beginTime+a.duration}if(a.path){var E=F.path.length;for(var x=0;C<E-1;x++){var r=F.path[x];var c=F.path[x+1];var A=r.points[0];var h=c.points[0];var u={pointX:A[0],pointY:A[1]};var D={pointX:h[0],pointY:h[1]};switch(r.type){case"MoveToPoint":case"AddLine":case"AddCurve":case"AddQuadCurve":y={property:"position",from:u,to:D,fillMode:"forwards",beginTime:p+a.beginTime+(x/(E-1))*a.duration,duration:1/(E-1)*a.duration,timingFunction:"linear",groupTimingFunction:d,groupBeginTime:v,groupDuration:b,groupTimingControlPoint1x:H,groupTimingControlPoint1y:G,groupTimingControlPoint2x:l,groupTimingControlPoint2y:f};break}this.addAction(y,a)}}else{if(a.keyTimes){var t=a.keyTimes.length;for(var x=0;x<t-1;x++){var s=a.keyTimes[x];var m=a.keyTimes[x+1];y={property:a.property,from:a.values[x],to:a.values[x+1],fillMode:a.fillMode,beginTime:p+a.beginTime+(s/1*a.duration),duration:(m-s)*a.duration,timingFunction:a.timingFunctions?a.timingFunctions[x]:"linear",groupTimingFunction:d,groupBeginTime:v,groupDuration:b,groupTimingControlPoint1x:H,groupTimingControlPoint1y:G,groupTimingControlPoint2x:l,groupTimingControlPoint2y:f};this.addAction(y,a)}}else{y={property:a.property,from:a.from,to:a.to,fillMode:a.fillMode,beginTime:p+a.beginTime,duration:a.duration,timingFunction:a.timingFunction?a.timingFunction:"linear",groupTimingFunction:d,groupBeginTime:v,groupDuration:b,groupTimingControlPoint1x:H,groupTimingControlPoint1y:G,groupTimingControlPoint2x:l,groupTimingControlPoint2y:f};this.addAction(y,a)}}}}else{var n=F.property;var B=this.keyAnimations[n];if(B==null){B={groupBeginTime:0,earliestBeginTime:F.beginTime,latestEndTime:-1,keyActions:[]};this.keyAnimations[n]=B}if(F.beginTime+F.duration>B.latestEndTime){B.latestEndTime=F.beginTime+F.duration}if(F.path){var E=F.path.length;for(var x=0;x<E-1;x++){var r=F.path[x];var c=F.path[x+1];var A=r.points[0];var h=c.points[0];var u={pointX:A[0],pointY:A[1]};var D={pointX:h[0],pointY:h[1]};switch(r.type){case"MoveToPoint":case"AddLine":case"AddCurve":case"AddQuadCurve":y={property:"position",from:u,to:D,fillMode:"forwards",beginTime:v+x/(E-1)*b,duration:1/(E-1)*b,timingFunction:"linear"};break}this.addAction(y,F)}}else{if(F.keyTimes){var t=F.keyTimes.length;for(var x=0;x<t-1;x++){var s=F.keyTimes[x];var m=F.keyTimes[x+1];y={property:F.property,from:F.values[x],to:F.values[x+1],fillMode:F.fillMode,beginTime:s/1*b,duration:(m-s)*b,timingFunction:F.timingFunctions?F.timingFunctions[x]:"linear"};this.addAction(y,F)}}else{y={property:F.property,from:F.from,to:F.to,fillMode:F.fillMode,beginTime:v,duration:b,timingFunction:d?d:"linear"};this.addAction(y,F)}}}}this.createKeyActions();this.createAnimationRules(I);this.createAnimationRuleForKeyframes(I)},addAction:function(b,a){if(a.timingFunction==="custom"){b.timingControlPoint1x=a.timingControlPoint1x;b.timingControlPoint1y=a.timingControlPoint1y;b.timingControlPoint2x=a.timingControlPoint2x;b.timingControlPoint2y=a.timingControlPoint2y}else{if(b.timingFunction.timingFunction!=null){if(b.timingFunction.timingFunction==="custom"){b.timingControlPoint1x=b.timingFunction.timingControlPoint1x;b.timingControlPoint1y=b.timingFunction.timingControlPoint1y;b.timingControlPoint2x=b.timingFunction.timingControlPoint2x;b.timingControlPoint2y=b.timingFunction.timingControlPoint2y}b.timingFunction=b.timingFunction.timingFunction}}this.animations.push(b)},createKeyActions:function(){for(var e=0,a=this.animations.length;e<a;e++){var c=this.animations[e];var d=c.beginTime;var b=c.duration;var g=d+b;var n=c.property;var h=this.keyAnimations[n];var m=h.keyActions;var k=h.latestEndTime-h.earliestBeginTime;var l=0;var j=100;if(k>0){l=100*d/this.overallEndTime;j=100*g/this.overallEndTime}if(j>100){j=100}var f={startKeyframe:l,endKeyframe:j,from:c.from,to:c.to,timingFunction:c.timingFunction};if(c.fillMode){f.fillMode=c.fillMode}if(c.timingFunction=="custom"){f.timingControlPoint1x=c.timingControlPoint1x;f.timingControlPoint1y=c.timingControlPoint1y;f.timingControlPoint2x=c.timingControlPoint2x;f.timingControlPoint2y=c.timingControlPoint2y}m.push(f);m.sort(this.sortAction)}},sortAction:function(b,a){return b.startKeyframe-a.startKeyframe},roundNum:function(a){return Math.round(a*this.kRoundingFactor)/this.kRoundingFactor},createAnimationRules:function(w){var f=this.kDelta;for(var h in this.keyAnimations){if(h=="playing"){continue}var q=this.keyAnimations[h];var g=q.keyActions;var j=false;q.keyframes=[];var o=g[0];var s=this.roundNum(o.startKeyframe);var m=this.roundNum(100*q.groupBeginTime/this.overallEndTime);if(h=="anchorPoint"){var c={};c.x=o.to.pointX;c.y=o.to.pointY;var n={pointX:-(o.from.pointX-w.anchorPoint.pointX)*w.bounds.width,pointY:-(o.from.pointY-w.anchorPoint.pointY)*w.bounds.height};if(w.isMagicMove){var u=this.anchorPointOffset(w,{x:o.from.pointX,y:o.from.pointY});var k={pointX:u.x,pointY:u.y};var d=this.anchorPointOffset(w,{x:o.to.pointX,y:o.to.pointY});var v={pointX:d.x,pointY:d.y};if(k.pointX!==v.pointX||k.pointY!=v.pointY){n={pointX:v.pointX-k.pointX,pointY:v.pointY-k.pointY};w.magicMoveOffsetValue=n}}if(s!=0){var t={pointX:0,pointY:0};if(m>0){this.insertInitialKeyframes(q,m-f,"position",t)}if(s-m>f){if(o.fillMode==="both"||o.fillMode==="backwards"){t=n}q.keyframes.push({keyframe:m,keyName:"position",value:t,timingFunction:"linear"});q.keyframes.push({keyframe:s-f,keyName:"position",value:t,timingFunction:"linear"})}}q.keyframes.push({keyframe:s,keyName:"position",value:n,timingFunction:"linear"});q.keyframes.push({keyframe:100,keyName:"position",value:n,timingFunction:"linear"});w.transformOriginValue=(c.x*100)+"% "+(c.y*100)+"%";continue}if(h=="anchorPointZ"){j=true;if(s!=0){var t=this.createInitialKeyframeValue(w,h,o.from,true);q.keyframes.push({keyframe:0,keyName:"zPosition",value:t,timingFunction:"linear"});q.keyframes.push({keyframe:s-f,keyName:"zPosition",value:t,timingFunction:"linear"})}q.keyframes.push({keyframe:s,keyName:"zPosition",value:o.from,timingFunction:"linear"});q.keyframes.push({keyframe:100,keyName:"zPosition",value:o.to,timingFunction:"linear"});w.transformOriginZValue=o.to.scalar;continue}if(o==null){continue}var l=0;var r=null;var e=null;if(s!=0){if(h==="hidden"){e={scalar:w.hidden};this.insertInitialKeyframes(q,s-f,h,e)}else{if(h==="opacity"){if(o.fillMode==="both"||o.fillMode==="backwards"){e=o.from}else{e={scalar:w.opacity}}this.insertInitialKeyframes(q,s-f,h,e)}else{if(h==="position"){if(w.isBuildIn||w.isBuildOut){if(m>0&&o.fillMode!=="both"&&o.fillMode!=="backwards"){e={pointX:0,pointY:0}}else{e={pointX:this.roundNum(o.from.pointX-w.initialState.position.pointX),pointY:this.roundNum(o.from.pointY-w.initialState.position.pointY)}}}else{e={pointX:0,pointY:0}}this.insertInitialKeyframes(q,s-f,h,e)}else{e=this.createInitialKeyframeValue(w,h,o.from,j);if(m>0){this.insertInitialKeyframes(q,m-f,h,e)}if(s-m>f){if(o.fillMode==="both"||o.fillMode==="backwards"){e=o.from}if(h==="transform.translation"){e.pointX=this.roundNum(e.pointX);e.pointY=this.roundNum(e.pointY)}q.keyframes.push({keyframe:m,keyName:h,value:e,timingFunction:"linear"});q.keyframes.push({keyframe:s-f,keyName:h,value:e,timingFunction:"linear"})}}}}l=o.startKeyframe;r=e}for(var p=0,b=g.length;p<b;p++){o=g[p];if(h=="position"){e=w.initialState.position;o.from={pointX:this.roundNum(o.from.pointX-e.pointX),pointY:this.roundNum(o.from.pointY-e.pointY)};o.to={pointX:this.roundNum(o.to.pointX-e.pointX),pointY:this.roundNum(o.to.pointY-e.pointY)}}if(Math.abs(o.startKeyframe-l)>f){q.keyframes.push({keyframe:this.roundNum(o.startKeyframe)-f,keyName:h,value:r,timingFunction:"linear"})}if(h==="transform.translation"){o.from.pointX=this.roundNum(o.from.pointX);o.from.pointY=this.roundNum(o.from.pointY);o.to.pointX=this.roundNum(o.to.pointX);o.to.pointY=this.roundNum(o.to.pointY)}var a=this.createTimingFunctionForAction(o);q.keyframes.push({keyframe:this.roundNum(o.startKeyframe),keyName:h,value:o.from,timingFunction:a});q.keyframes.push({keyframe:this.roundNum(o.endKeyframe)-(o.endKeyframe==100?0:f),keyName:h,value:o.to,timingFunction:a});r=o.to;l=o.endKeyframe}if(l!=100&&h!="hidden"){q.keyframes.push({keyframe:this.roundNum(l),keyName:h,value:r,timingFunction:"linear"});q.keyframes.push({keyframe:100,keyName:h,value:r,timingFunction:"linear"})}}},insertInitialKeyframes:function(b,c,d,a){b.keyframes.push({keyframe:0,keyName:d,value:a,timingFunction:"linear"});b.keyframes.push({keyframe:c,keyName:d,value:a,timingFunction:"linear"})},anchorPointOffset:function(c,e){var a={};var b={};var f={};var d=c.bounds;a.x=d.width/2;a.y=d.height/2;b.x=e.x*d.width;b.y=e.y*d.height;f.x=(a.x-b.x);f.y=(a.y-b.y);return f},createInitialKeyframeValue:function(a,c,e,b){var d={};switch(c){case"anchorPoint":d.pointX=(a.anchorPoint.pointX-0.5)*a.bounds.width;d.pointY=(a.anchorPoint.pointY-0.5)*a.bounds.height;break;case"anchorPointZ":if(Prototype.Browser.Gecko||Prototype.Browser.IE||isChrome||isIE||isEdge){d.scalar=0}else{d.scalar=e.scalar+e.scalar}break;case"opacity":case"opacityMultiplier":d.scalar=a.opacity;break;case"hidden":d.scalar=a.hidden;break;case"position":d.pointX=a.affineTransform[4];d.pointY=a.affineTransform[5];break;case"zPosition":d.scalar=0;break;case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":d.scalar=a.initialState.scale;break;case"transform.rotation.z":d.scalar=a.initialState.rotation;case"transform":d.transform=e.transform;break;case"bounds":d.pointX=0;d.pointY=0;d.width=a.initialState.width;d.height=a.initialState.height;break;default:d.scalar=0;d.pointX=0;d.pointY=0;break}return d},createTimingFunctionForAction:function(c){var b="";var a=c.timingFunction;var d=c;if(typeof a==="object"){a=a.timingFunction;d=c.timingFunction}switch(a.toLowerCase()){case"easein":b="ease-in";break;case"easeout":b="ease-out";break;case"easeinout":case"easeineaseout":b="ease-in-out";break;case"custom":b="cubic-bezier("+d.timingControlPoint1x+","+d.timingControlPoint1y+","+d.timingControlPoint2x+","+d.timingControlPoint2y+")";break;case"linear":b="linear";break;default:b="linear";break}return b},createAnimationRuleForKeyframes:function(d){for(var n in this.keyAnimations){var f=this.keyAnimations[n];var e="layer"+d.layerId+"-"+escapeTextureId(n);var b;var h="";var o;if(n==="contents"){var m=this.roundNum(f.keyActions[0].startKeyframe);b=gShowController.animationManager.createAnimation(e+"-from");var l="0% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}";var k="49.999% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}";var j="50% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";var g="100% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";if(m!==0){k=((100-m)/2+m-this.kDelta)-this.kDelta+"% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}";j=((100-m)/2+m)+"% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}"}b.appendRule(l);b.appendRule(k);b.appendRule(j);b.appendRule(g);b=gShowController.animationManager.createAnimation(e+"-to");l="0% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";k="49.999% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";j="50% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}";g="100% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}";if(m!==0){k=((100-m)/2+m-this.kDelta)-this.kDelta+"% {opacity: 0; "+kAnimationTimingFunctionPropertyName+": linear;}";j=((100-m)/2+m)+"% {opacity: 1; "+kAnimationTimingFunctionPropertyName+": linear;}"}b.appendRule(l);b.appendRule(k);b.appendRule(j);b.appendRule(g);continue}if(!isIE){b=gShowController.animationManager.createAnimation(e);for(var c=0,a=f.keyframes.length;c<a;c++){o=f.keyframes[c];h=this.createAnimationRuleForKeyframe(n,o,d)+" ";b.appendRule(h)}d.cssAnimationRules.push(e)}else{if(browserVersion>=10){for(var c=0,a=f.keyframes.length;c<a;c++){o=f.keyframes[c];h+=this.createAnimationRuleForKeyframe(n,o,d)+" "}gShowController.animationManager.styleSheet.insertRule(kKeyframesPropertyName+" "+e+" {"+h+"}",0);d.cssAnimationRules.push(e)}}}},createAnimationRuleForKeyframe:function(l,m,g){var j=m.keyframe;var f=m.keyName;var k=m.value;var n=m.timingFunction;var d;var c=g.transformOriginValue;var e=g.transformOriginZValue;var h="";if(c){h=kTransformOriginPropertyName+": "+c+";"}if(f=="hidden"){var a={scalar:-1};if(k.scalar==false){a.scalar=1}else{a.scalar=0}f="opacity";d=this.cssPropertyValueForActionValue(l,f,a)}else{d=this.cssPropertyValueForActionValue(l,f,k)}var b;b=this.cssPropertyNameForAction(f)+": "+d+"; "+(j<100?kAnimationTimingFunctionPropertyName+": "+n+";":"");var i=j+"% {"+h+b+"}";return i},cssPropertyValueForActionValue:function(b,a,c){switch(a){case"hidden":if(c.scalar==true){return"hidden"}else{return"visible"}case"anchorPoint":return c.pointX+"% "+c.pointY+"%";case"anchorPointZ":return c.scalar;case"position":return"translate("+c.pointX+"px,"+c.pointY+"px)";case"zPosition":if(b=="anchorPointZ"&&(Prototype.Browser.Gecko||navigator.userAgent.lastIndexOf("Chrome/")>0)){return"translateZ("+-c.scalar+"px)"}else{return"translateZ("+c.scalar+"px)"}case"translationEmphasis":return"translateX("+c.translationEmphasis[0]+"px) translateY("+c.translationEmphasis[1]+"px) translateZ("+c.translationEmphasis[2]+")";case"rotationEmphasis":return"rotateZ("+c.rotationEmphasis[6]+"rad)";case"scaleEmphasis":return"scale3d("+ensureScaleFactorNotZero(c.scaleEmphasis[3])+","+ensureScaleFactorNotZero(c.scaleEmphasis[4])+","+ensureScaleFactorNotZero(c.scaleEmphasis[5])+")";case"transform.scale":case"transform.scale.xy":return"scale("+ensureScaleFactorNotZero(c.scalar)+")";case"transform.scale.x":return"scaleX("+ensureScaleFactorNotZero(c.scalar)+")";case"transform.scale.y":return"scaleY("+ensureScaleFactorNotZero(c.scalar)+")";case"transform.rotation.x":return"rotateX("+c.scalar+"rad)";case"transform.rotation.y":return"rotateY("+c.scalar+"rad)";case"transform.rotation.z":case"transform.rotation":return"rotateZ("+c.scalar+"rad)";case"transform.translation":return"translateX("+c.pointX+"px) translateY("+c.pointY+"px)";case"transform.translation.x":return"translateX("+c.scalar+"px)";case"transform.translation.y":return"translateY("+c.scalar+"px)";case"transform.translation.z":return"translateZ("+c.scalar+"px)";case"isPlaying":case"opacity":case"opacityMultiplier":return c.scalar+"";case"transform":return"matrix3d("+c.transform+")";case"doubleSided":if(c.scalar==false){return"hidden"}else{return"visible"}case"contents":return c.texture;default:return"some value"}},cssPropertyNameForAction:function(a){switch(a){case"hidden":return kVisibilityPropertyName;case"anchorPoint":return kTransformOriginPropertyName;case"anchorPointZ":return kTransformOriginZPropertyName;case"opacityMultiplier":return kOpacityPropertyName;case"translationEmphasis":case"rotationEmphasis":case"scaleEmphasis":case"position":case"zPosition":case"transform":case"transform.scale":case"transform.scale.xy":case"transform.scale.x":case"transform.scale.y":case"transform.rotation.x":case"transform.rotation.y":case"transform.rotation.z":case"transform.rotation":case"transform.translation":case"transform.translation.x":case"transform.translation.y":case"transform.translation.z":case"bounds":return kTransformPropertyName;case"doubleSided":return kBackfaceVisibilityPropertyName;case"contents":return kBackgroundImagePropertyName;default:return a}}});